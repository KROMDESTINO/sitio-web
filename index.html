<html><head><base href="https://boardgamemeetuporganizer.com/">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#667eea">
<title>Â¡ApÃºntate a Partidas de Juegos de Mesa!</title>
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192x192.png">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

    body {
        font-family: 'Poppins', sans-serif;
        margin: 0;
        padding: 0;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 800 800"><defs><pattern id="dicePattern" patternUnits="userSpaceOnUse" width="100" height="100"><circle cx="50" cy="50" r="20" fill="%23ffffff22"/><circle cx="50" cy="50" r="5" fill="%23ffffff44"/></pattern></defs><rect width="100%" height="100%" fill="%23667eea"/><rect width="100%" height="100%" fill="url(%23dicePattern)"/></svg>') no-repeat center center fixed;
        background-size: cover;
    }

    .container {
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 20px;
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        padding: 20px;
        width: 90%;
        max-width: 1000px;
    }

    #clubLogo {
        display: block;
        max-width: 100%;
        height: auto;
        margin: 0 auto 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    @media (min-width: 768px) {
        #clubLogo {
            max-width: 300px;
        }
    }

    h1 {
        color: #4a4a4a;
        text-align: center;
        margin-bottom: 30px;
        font-size: 2.2em;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    #attendanceStats {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 40px;
        background-color: #f0f0f0;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    #attendanceStats h2 {
        color: #4a4a4a;
        margin-top: 0;
        margin-bottom: 20px;
        text-align: center;
    }

    #toggleStats {
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 1000;
    }

    .days {
        display: flex;
        justify-content: space-between;
        margin-bottom: 40px;
        flex-wrap: wrap;
    }

    .day {
        flex: 1;
        min-width: 250px;
        margin: 10px;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .day:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .friday {
        background-color: #FFD700;
    }

    .saturday {
        background-color: #98FB98;
    }

    .sunday {
        background-color: #87CEFA;
    }

    .day h2 {
        margin-top: 0;
        color: #333;
        text-align: center;
        font-size: 1.8em;
        margin-bottom: 5px;
    }

    .day p {
        text-align: center;
        color: #444;
        margin-top: 0;
        margin-bottom: 20px;
    }

    .day input[type="text"], .day input[type="date"], .day select {
        background-color: rgba(255, 255, 255, 0.7);
        border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .day button {
        background-color: #4a4a4a;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: bold;
    }

    .day button:hover {
        background-color: #333;
        transform: scale(1.05);
    }

    ul {
        list-style-type: none;
        padding: 0;
    }

    li {
        background-color: #ffffff;
        margin-bottom: 10px;
        padding: 15px;
        border-radius: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    button {
        background-color: #6c5ce7;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: bold;
    }

    button:hover {
        background-color: #5541d7;
        transform: scale(1.05);
    }

    input[type="text"], input[type="date"], select {
        width: 100%;
        padding: 12px;
        margin-bottom: 15px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 1em;
    }

    .munchis {
        display: flex;
        flex-direction: column;
        margin-top: 15px;
        margin-bottom: 15px;
    }

    .munchis label {
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        cursor: pointer;
    }

    .munchis input[type="radio"] {
        margin-right: 10px;
    }

    #gameProposal, #proposedGames, #upcomingActivities {
        margin-top: 40px;
        background-color: #f0f0f0;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    #gameProposal h2, #proposedGames h2, #upcomingActivities h2 {
        color: #4a4a4a;
        margin-top: 0;
        margin-bottom: 20px;
        text-align: center;
    }

    #gamesList li {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .emoji {
        font-size: 1.5em;
        margin-left: 10px;
    }

    .dice-icon {
        font-size: 1.5em;
        margin-right: 10px;
    }

    #statsContent {
        margin-bottom: 20px;
        text-align: center;
    }

    @keyframes fadeInOut {
        0% { opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% { opacity: 0; }
    }

    @keyframes moveRight {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100vw); }
    }

    @keyframes moveLeft {
        0% { transform: translateX(100vw); }
        100% { transform: translateX(-100%); }
    }

    @keyframes rotateDice {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .dice-animation {
        position: fixed;
        width: 50px;
        height: 50px;
        background-size: contain;
        background-repeat: no-repeat;
        z-index: -1;
        animation: moveRight 20s linear infinite, rotateDice 4s linear infinite;
    }

    .dice-1 {
        top: 20%;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23ffffff' d='M5 3h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2m7 7a2 2 0 0 0-2 2a2 2 0 0 0 2 2a2 2 0 0 0 2-2a2 2 0 0 0-2-2Z'/%3E%3C/svg%3E");
    }

    .dice-2 {
        top: 40%;
        animation-delay: -5s;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23ffffff' d='M5 3h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2m2 14h2a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1m10-10h-2a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1Z'/%3E%3C/svg%3E");
    }

    .dice-3 {
        top: 60%;
        animation-delay: -10s;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23ffffff' d='M5 3h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2m7 7a2 2 0 0 0-2 2a2 2 0 0 0 2 2a2 2 0 0 0 2-2a2 2 0 0 0-2-2M7 5a2 2 0 0 0-2 2a2 2 0 0 0 2 2a2 2 0 0 0 2-2a2 2 0 0 0-2-2m10 10a2 2 0 0 0-2 2a2 2 0 0 0 2 2a2 2 0 0 0 2-2a2 2 0 0 0-2-2Z'/%3E%3C/svg%3E");
    }

    #adminPanel {
        display: none;
        margin-top: 20px;
        text-align: center;
    }

    #adminPanel input[type="password"], #aiTrainingInput {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border: 2px solid #ddd;
        border-radius: 8px;
    }

    #upcomingActivities {
        margin-top: 40px;
        background-color: #f0f0f0;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    #upcomingActivities h2 {
        color: #4a4a4a;
        margin-top: 0;
        margin-bottom: 20px;
        text-align: center;
    }

    #activitiesList li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    #activitiesList li button {
        background-color: #ff4d4d;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
    }

    #adminActivities input[type="text"] {
        width: calc(100% - 110px);
        padding: 10px;
        margin-right: 10px;
    }

    #adminActivities button {
        padding: 10px;
    }

    @media (max-width: 768px) {
        .container {
            padding: 20px;
        }

        .day {
            min-width: 100%;
        }

        h1 {
            font-size: 1.8em;
        }

        .day h2 {
            font-size: 1.5em;
        }

        button {
            padding: 10px 15px;
        }
    }
</style>
</head>
   <!-- Agregar los scripts de Firebase -->
<script type="module">
  // Importar las funciones necesarias del SDK de Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
  // TODO: AÃ±adir SDKs de los productos de Firebase que quieres utilizar
  // https://firebase.google.com/docs/web/setup#available-libraries

  // ConfiguraciÃ³n de Firebase para tu aplicaciÃ³n web
  const firebaseConfig = {
    apiKey: "AIzaSyDxqAMsDpuzsGNcZzK1d74ucvIV4bfAOE",
    authDomain: "juegos-de-mesa-9d7ef.firebaseapp.com",
    databaseURL: "https://juegos-de-mesa-9d7ef-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "juegos-de-mesa-9d7ef",
    storageBucket: "juegos-de-mesa-9d7ef.appspot.com",
    messagingSenderId: "289986562577",
    appId: "1:289986562577:web:02878f48c9154cebf8b0"
  };
  // Inicializar Firebase
  const app = initializeApp(firebaseConfig);
  // AquÃ­ agregarÃ­as otras importaciones necesarias, como Firestore
  import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
  const db = getFirestore(app); // Inicializa Firestore
</script>
<script type="module">
  // Importar las funciones necesarias del SDK de Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

  // ConfiguraciÃ³n de Firebase (que ya pegaste)
  const firebaseConfig = {
    apiKey: "AIzaSyDxqAMsDpuzsGNcZzK1d74ucvIV4bfAOE",
    authDomain: "juegos-de-mesa-9d7ef.firebaseapp.com",
    databaseURL: "https://juegos-de-mesa-9d7ef-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "juegos-de-mesa-9d7ef",
    storageBucket: "juegos-de-mesa-9d7ef.appspot.com",
    messagingSenderId: "289986562577",
    appId: "1:289986562577:web:02878f48c9154cebf8b0"
  };

  // Inicializar Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app); // Inicializa Firestore

  // FunciÃ³n para agregar un jugador a Firestore
  async function addPlayer() {
    const nombre = document.getElementById('nombre').value;
    const dia = document.getElementById('dia').value;
    const hora = document.getElementById('hora').value;

    if (nombre === '' || dia === '' || hora === '') {
      alert('Por favor, completa todos los campos.');
      return;
    }

    try {
      await addDoc(collection(db, "players"), { nombre, dia, hora });
      alert('Jugador registrado exitosamente!');
      getPlayers(); // Actualizar la lista de jugadores despuÃ©s de agregar
    } catch (error) {
      console.error('Error al registrar jugador:', error);
    }
  }

  // FunciÃ³n para obtener todos los jugadores de Firestore
  async function getPlayers() {
    const listaJugadores = document.getElementById('lista-jugadores');
    listaJugadores.innerHTML = ''; // Limpiar la lista antes de agregar los jugadores

    try {
      const querySnapshot = await getDocs(collection(db, "players"));
      querySnapshot.forEach((doc) => {
        const jugador = doc.data();
        const li = document.createElement('li');
        li.textContent = `${jugador.nombre} - ${jugador.dia} - ${jugador.hora}`;
        li.setAttribute('data-id', doc.id);
        li.innerHTML += ` <button onclick="deletePlayer('${doc.id}')">Eliminar</button> 
                          <button onclick="editPlayer('${doc.id}')">Editar</button>`;
        listaJugadores.appendChild(li);
      });
    } catch (error) {
      console.error('Error al obtener jugadores:', error);
    }
  }

  // FunciÃ³n para eliminar un jugador
  async function deletePlayer(id) {
    try {
      await deleteDoc(doc(db, "players", id));
      alert('Jugador eliminado correctamente!');
      getPlayers(); // Actualizar la lista de jugadores despuÃ©s de eliminar
    } catch (error) {
      console.error('Error al eliminar jugador:', error);
    }
  }

  // FunciÃ³n para editar un jugador
  function editPlayer(id) {
    const nombre = prompt('Nuevo nombre:');
    const dia = prompt('Nuevo dÃ­a (YYYY-MM-DD):');
    const hora = prompt('Nueva hora (HH:MM):');

    if (nombre && dia && hora) {
      updatePlayer(id, { nombre, dia, hora });
    }
  }

  // FunciÃ³n para actualizar un jugador en Firestore
  async function updatePlayer(id, newData) {
    try {
      const playerRef = doc(db, "players", id);
      await updateDoc(playerRef, newData);
      alert('Jugador actualizado correctamente!');
      getPlayers(); // Actualizar la lista de jugadores despuÃ©s de actualizar
    } catch (error) {
      console.error('Error al actualizar jugador:', error);
    }
  }

  // FunciÃ³n para manejar cambios en las fechas
  function updateDates() {
    console.log('FunciÃ³n updateDates llamada');
    // AquÃ­ puedes aÃ±adir lÃ³gica para manejar cambios en las fechas
  }

  // Llamar a getPlayers al cargar la pÃ¡gina para mostrar los jugadores existentes
  getPlayers();
</script>
<body>
    <div class="container">
        <img src="/a/cdaf20ad-c9d1-42cb-a2d5-3740947188b1" alt="Logo del club de juegos de mesa" id="clubLogo">
        <h1>ðŸŽ² Â¡ApÃºntate a Partidas de Juegos de Mesa! ðŸŽ²</h1>
        <button id="toggleStats" onclick="toggleStatsDisplay()">Info</button>

        <div class="days">
            <div class="day friday">
                <h2>Viernes</h2>
                <input type="date" id="fridayDateInput" onchange="updateDates()">
                <p id="fridayDate"></p>
                <ul id="fridayList"></ul>
                <input type="text" id="fridayName" placeholder="Tu nombre">
                <select id="fridayTime">
                    <option value="">Selecciona hora</option>
                    <option value="17:00">17:00</option>
                    <option value="18:00">18:00</option>
                    <option value="19:00">19:00</option>
                    <option value="20:00">20:00</option>
                </select>
                <div class="munchis">
                    <label>
                        <input type="radio" name="fridayMunchis" value="want"> Quiero munchis
                    </label>
                    <label>
                        <input type="radio" name="fridayMunchis" value="bring"> Compro yo las munchis
                    </label>
                    <label>
                        <input type="radio" name="fridayMunchis" value="none" checked> No quiero munchis
                    </label>
                </div>
                <button onclick="addPlayer('friday')">Apuntarme</button>
            </div>
            
            <div class="day saturday">
                <h2>SÃ¡bado</h2>
                <input type="date" id="saturdayDateInput" onchange="updateDates()">
                <p id="saturdayDate"></p>
                <ul id="saturdayList"></ul>
                <input type="text" id="saturdayName" placeholder="Tu nombre">
                <select id="saturdayTime">
                    <option value="">Selecciona hora</option>
                    <option value="17:00">17:00</option>
                    <option value="18:00">18:00</option>
                    <option value="19:00">19:00</option>
                    <option value="20:00">20:00</option>
                </select>
                <div class="munchis">
                    <label>
                        <input type="radio" name="saturdayMunchis" value="want"> Quiero munchis
                    </label>
                    <label>
                        <input type="radio" name="saturdayMunchis" value="bring"> Compro yo las munchis
                    </label>
                    <label>
                        <input type="radio" name="saturdayMunchis" value="none" checked> No quiero munchis
                    </label>
                </div>
                <button onclick="addPlayer('saturday')">Apuntarme</button>
            </div>
            
            <div class="day sunday">
                <h2>Domingo</h2>
                <input type="date" id="sundayDateInput" onchange="updateDates()">
                <p id="sundayDate"></p>
                <ul id="sundayList"></ul>
                <input type="text" id="sundayName" placeholder="Tu nombre">
                <select id="sundayTime">
                    <option value="">Selecciona hora</option>
                    <option value="17:00">17:00</option>
                    <option value="18:00">18:00</option>
                    <option value="19:00">19:00</option>
                    <option value="20:00">20:00</option>
                </select>
                <div class="munchis">
                    <label>
                        <input type="radio" name="sundayMunchis" value="want"> Quiero munchis
                    </label>
                    <label>
                        <input type="radio" name="sundayMunchis" value="bring"> Compro yo las munchis
                    </label>
                    <label>
                        <input type="radio" name="sundayMunchis" value="none" checked> No quiero munchis
                    </label>
                </div>
                <button onclick="addPlayer('sunday')">Apuntarme</button>
            </div>
        </div>
        
        <div id="gameProposal">
            <h2><span class="dice-icon">ðŸŽ²</span> PropÃ³n un Juego <span class="dice-icon">ðŸŽ²</span></h2>
            <input type="text" id="gameProposalInput" placeholder="Nombre del juego">
            <button onclick="proposeGame()">Proponer Juego</button>
        </div>
        
        <div id="proposedGames">
            <h2><span class="dice-icon">ðŸŽ²</span> Juegos Propuestos <span class="dice-icon">ðŸŽ²</span></h2>
            <ul id="gamesList"></ul>
        </div>

        <div id="attendanceStats" style="display: none;">
            <h2><span class="dice-icon">ðŸ“Š</span> EstadÃ­sticas de Asistencia <span class="dice-icon">ðŸ“Š</span></h2>
            <div id="statsContent"></div>
            <div>
                <button onclick="adjustAttendance('friday', 1)">Viernes +</button>
                <button onclick="adjustAttendance('friday', -1)">Viernes -</button>
                <button onclick="adjustAttendance('saturday', 1)">SÃ¡bado +</button>
                <button onclick="adjustAttendance('saturday', -1)">SÃ¡bado -</button>
                <button onclick="adjustAttendance('sunday', 1)">Domingo +</button>
                <button onclick="adjustAttendance('sunday', -1)">Domingo -</button>
            </div>
        </div>

        <div id="upcomingActivities">
            <h2><span class="dice-icon">ðŸ“…</span> PrÃ³ximas Actividades <span class="dice-icon">ðŸ“…</span></h2>
            <ul id="activitiesList"></ul>
            <div id="adminActivities" style="display: none;">
                <input type="text" id="activityInput" placeholder="Nueva actividad">
                <button onclick="addActivity()">AÃ±adir Actividad</button>
                <button onclick="exitAdminActivities()">Salir</button>
            </div>
            <button onclick="toggleAdminActivities()">Admin Actividades</button>
        </div>

        <div id="adminPanel">
            <input type="password" id="adminPassword" placeholder="Admin password">
            <button onclick="authenticateAdmin()">Login</button>
            <div id="aiTraining" style="display: none;">
                <textarea id="aiTrainingInput" placeholder="Enter information to train the AI..."></textarea>
                <button onclick="trainAI()">Train AI</button>
            </div>
        </div>
    </div>

    <script>
        let players = {
            friday: [],
            saturday: [],
            sunday: []
        };
        
        let proposedGames = [];
        let manualAdjustments = {
            friday: 0,
            saturday: 0,
            sunday: 0
        };

        const responses = {
            'hola': 'Â¡Hola! Â¿En quÃ© puedo ayudarte con los juegos de mesa?',
            'juego': 'Hay muchos juegos de mesa geniales. Â¿QuÃ© tipo de juego te interesa?',
            'estrategia': 'Los juegos de estrategia son excelentes. Te recomiendo Catan o Risk.',
            'familia': 'Para juegos familiares, Monopoly o UNO son clÃ¡sicos divertidos.',
            'rol': 'Si te gustan los juegos de rol, Dungeons & Dragons es un must.',
            'cartas': 'Hay muchos juegos de cartas geniales como Magic: The Gathering o Exploding Kittens.',
            'cooperativo': 'Pandemic es un excelente juego cooperativo.',
            'ayuda': 'Â¡Claro! Estoy aquÃ­ para ayudarte con preguntas sobre juegos de mesa. Â¿QuÃ© quieres saber?',
        };

        function addPlayer(day) {
            const nameInput = document.getElementById(`${day}Name`);
            const timeSelect = document.getElementById(`${day}Time`);
            const munchisRadios = document.getElementsByName(`${day}Munchis`);
            const name = nameInput.value.trim();
            const time = timeSelect.value;
            
            if (name && time) {
                let munchisChoice = 'none';
                for (const radio of munchisRadios) {
                    if (radio.checked) {
                        munchisChoice = radio.value;
                        break;
                    }
                }
                
                const player = {
                    name: name,
                    time: time,
                    munchis: munchisChoice
                };
                
                players[day].push(player);
                showConfirmation(`${name} se ha apuntado correctamente para el ${day} a las ${time}`);
                updatePlayerList(day);
                nameInput.value = '';
                timeSelect.value = '';
                munchisRadios.forEach(radio => radio.checked = false);
                document.querySelector(`input[name="${day}Munchis"][value="none"]`).checked = true;
                updateStats();
                saveStats();
            } else {
                alert("Por favor, ingresa tu nombre y selecciona una hora.");
            }
        }

        function showConfirmation(message) {
            const confirmationDiv = document.createElement('div');
            confirmationDiv.textContent = message;
            confirmationDiv.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background-color: #4CAF50;
                color: white;
                padding: 15px;
                border-radius: 5px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                z-index: 1000;
                animation: fadeInOut 3s ease-in-out;
            `;
            document.body.appendChild(confirmationDiv);
            setTimeout(() => {
                document.body.removeChild(confirmationDiv);
            }, 3000);
        }

        function updatePlayerList(day) {
            const list = document.getElementById(`${day}List`);
            list.innerHTML = '';
            
            // Group players by time
            const groupedPlayers = {};
            players[day].forEach(player => {
                if (!groupedPlayers[player.time]) {
                    groupedPlayers[player.time] = [];
                }
                groupedPlayers[player.time].push(player);
            });
            
            // Sort times and create list items
            Object.keys(groupedPlayers).sort().forEach(time => {
                const timeHeader = document.createElement('li');
                timeHeader.innerHTML = `<strong>${time}</strong>`;
                list.appendChild(timeHeader);
                
                groupedPlayers[time].forEach((player, index) => {
                    const li = document.createElement('li');
                    li.innerHTML = `${player.name} <span class="emoji">${getMunchisEmoji(player.munchis)}</span>`;
                    const removeBtn = document.createElement('button');
                    removeBtn.textContent = 'Eliminar';
                    removeBtn.onclick = () => removePlayer(day, players[day].indexOf(player));
                    li.appendChild(removeBtn);
                    list.appendChild(li);
                });
            });
        }

        function getMunchisEmoji(munchisChoice) {
            switch(munchisChoice) {
                case 'want': return 'ðŸ¿';
                case 'bring': return 'ðŸ›’';
                default: return '';
            }
        }

        function removePlayer(day, index) {
            players[day].splice(index, 1);
            updatePlayerList(day);
            updateStats();
            saveStats();
        }

        function proposeGame() {
            const gameInput = document.getElementById('gameProposalInput');
            const game = gameInput.value.trim();
            
            if (game && !proposedGames.includes(game)) {
                proposedGames.push(game);
                updateGamesList();
                gameInput.value = '';
            }
        }

        function updateGamesList() {
            const gamesList = document.getElementById('gamesList');
            gamesList.innerHTML = '';
            proposedGames.forEach((game, index) => {
                const li = document.createElement('li');
                li.textContent = game;
                const removeBtn = document.createElement('button');
                removeBtn.textContent = 'Eliminar';
                removeBtn.onclick = () => removeGame(index);
                li.appendChild(removeBtn);
                gamesList.appendChild(li);
            });
        }

        function removeGame(index) {
            proposedGames.splice(index, 1);
            updateGamesList();
        }

        function toggleStatsDisplay() {
            const statsDiv = document.getElementById('attendanceStats');
            const toggleBtn = document.getElementById('toggleStats');
            if (statsDiv.style.display === 'none') {
                statsDiv.style.display = 'block';
                toggleBtn.textContent = 'Ocultar EstadÃ­sticas';
                updateStats();
            } else {
                statsDiv.style.display = 'none';
                toggleBtn.textContent = 'Mostrar EstadÃ­sticas';
            }
        }

        function updateStats() {
            const statsContent = document.getElementById('statsContent');
            const fridayAttendance = players.friday.length + manualAdjustments.friday;
            const saturdayAttendance = players.saturday.length + manualAdjustments.saturday;
            const sundayAttendance = players.sunday.length + manualAdjustments.sunday;
            const totalAttendance = fridayAttendance + saturdayAttendance + sundayAttendance;

            statsContent.innerHTML = `
                <p>Viernes: ${fridayAttendance} asistentes</p>
                <p>SÃ¡bado: ${saturdayAttendance} asistentes</p>
                <p>Domingo: ${sundayAttendance} asistentes</p>
                <p><strong>Total: ${totalAttendance} asistentes</strong></p>
            `;
        }

        function adjustAttendance(day, change) {
            manualAdjustments[day] += change;
            updateStats();
            saveStats();
        }

        function saveStats() {
            localStorage.setItem('boardGameStats', JSON.stringify({
                players: players,
                manualAdjustments: manualAdjustments
            }));
        }

        function loadStats() {
            const savedStats = localStorage.getItem('boardGameStats');
            if (savedStats) {
                const stats = JSON.parse(savedStats);
                players = stats.players;
                manualAdjustments = stats.manualAdjustments;
                updatePlayerList('friday');
                updatePlayerList('saturday');
                updatePlayerList('sunday');
                updateStats();
            }
        }

        function updateDates() {
            const fridayInput = document.getElementById('fridayDateInput');
            const saturdayInput = document.getElementById('saturdayDateInput');
            const sundayInput = document.getElementById('sundayDateInput');

            const friday = fridayInput.value ? new Date(fridayInput.value) : getNextFriday();
            const saturday = saturdayInput.value ? new Date(saturdayInput.value) : new Date(friday.getTime() + 86400000);
            const sunday = sundayInput.value ? new Date(sundayInput.value) : new Date(saturday.getTime() + 86400000);

            fridayInput.value = friday.toISOString().split('T')[0];
            saturdayInput.value = saturday.toISOString().split('T')[0];
            sundayInput.value = sunday.toISOString().split('T')[0];

            document.getElementById('fridayDate').textContent = formatDate(friday);
            document.getElementById('saturdayDate').textContent = formatDate(saturday);
            document.getElementById('sundayDate').textContent = formatDate(sunday);

            saveDates();
        }

        function getNextFriday() {
            const today = new Date();
            const friday = new Date(today);
            friday.setDate(today.getDate() + (5 + 7 - today.getDay()) % 7);
            return friday;
        }

        function formatDate(date) {
            return `${date.getDate()} de ${date.toLocaleString('es-ES', { month: 'long' })}`;
        }

        function saveDates() {
            const dates = {
                friday: document.getElementById('fridayDateInput').value,
                saturday: document.getElementById('saturdayDateInput').value,
                sunday: document.getElementById('sundayDateInput').value
            };
            localStorage.setItem('boardGameDates', JSON.stringify(dates));
        }

        function loadDates() {
            const savedDates = localStorage.getItem('boardGameDates');
            if (savedDates) {
                const dates = JSON.parse(savedDates);
                document.getElementById('fridayDateInput').value = dates.friday;
                document.getElementById('saturdayDateInput').value = dates.saturday;
                document.getElementById('sundayDateInput').value = dates.sunday;
            }
            updateDates();
        }

        window.onload = function() {
            loadDates();
            loadStats();
            updateStats();
            loadActivities();
            
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((reg) => console.log('Service worker registered', reg))
                    .catch((err) => console.log('Service worker not registered', err));
            }
        }

        function authenticateAdmin() {
            const password = document.getElementById('adminPassword').value;
            if (password === '1234') {
                document.getElementById('aiTraining').style.display = 'block';
            } else {
                alert('Incorrect password');
            }
        }

        function trainAI() {
            const trainingData = document.getElementById('aiTrainingInput').value;
            responses['custom'] = trainingData;
            alert('AI trained with new information');
        }

        function addActivity() {
            const activityInput = document.getElementById('activityInput');
            const activity = activityInput.value.trim();
            
            if (activity) {
                const activitiesList = document.getElementById('activitiesList');
                const li = document.createElement('li');
                li.textContent = activity;
                const removeBtn = document.createElement('button');
                removeBtn.textContent = 'Eliminar';
                removeBtn.onclick = () => removeActivity(li);
                li.appendChild(removeBtn);
                activitiesList.appendChild(li);
                activityInput.value = '';
                saveActivities();
            }
        }

        function removeActivity(activityElement) {
            activityElement.remove();
            saveActivities();
        }

        function saveActivities() {
            const activitiesList = document.getElementById('activitiesList');
            const activities = Array.from(activitiesList.children).map(li => li.textContent.replace('Eliminar', '').trim());
            localStorage.setItem('upcomingActivities', JSON.stringify(activities));
        }

        function loadActivities() {
            const savedActivities = localStorage.getItem('upcomingActivities');
            if (savedActivities) {
                const activities = JSON.parse(savedActivities);
                const activitiesList = document.getElementById('activitiesList');
                activitiesList.innerHTML = '';
                activities.forEach(activity => {
                    const li = document.createElement('li');
                    li.textContent = activity;
                    const removeBtn = document.createElement('button');
                    removeBtn.textContent = 'Eliminar';
                    removeBtn.onclick = () => removeActivity(li);
                    li.appendChild(removeBtn);
                    activitiesList.appendChild(li);
                });
            }
        }

        function toggleAdminActivities() {
            const password = prompt("Por favor, introduce la contraseÃ±a de administrador para actividades:");
            if (password === '2822') {
                const adminActivities = document.getElementById('adminActivities');
                adminActivities.style.display = 'block';
            } else {
                alert("ContraseÃ±a incorrecta. Acceso denegado.");
            }
        }

        function exitAdminActivities() {
            const adminActivities = document.getElementById('adminActivities');
            adminActivities.style.display = 'none';
        }
    </script>
    <div class="dice-animation dice-1"></div>
    <div class="dice-animation dice-2"></div>
    <div class="dice-animation dice-3"></div>
</body>
</html>
