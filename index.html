<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Juegos de Mesa</title>
</head>
<body>
  <h1>Registro de Jugadores</h1>
  
  <!-- Formulario para agregar jugadores -->
  <div>
    <label for="nombre">Nombre del Jugador:</label>
    <input type="text" id="nombre" placeholder="Escribe el nombre">
    <br>
    <label for="dia">Día:</label>
    <input type="date" id="dia" onchange="updateDates()">
    <br>
    <label for="hora">Hora:</label>
    <input type="time" id="hora">
    <br>
    <button onclick="addPlayer()">Agregar Jugador</button>
  </div>

  <!-- Mostrar lista de jugadores -->
  <div>
    <h2>Lista de Jugadores</h2>
    <ul id="lista-jugadores"></ul>
  </div>
  
  <!-- Agregar los scripts de Firebase -->
  <script type="module">
    // Importar las funciones necesarias del SDK de Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    // Configuración de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDxqAMsDpuzsGNcZzK1d74ucvIV4bfAOE",
      authDomain: "juegos-de-mesa-9d7ef.firebaseapp.com",
      databaseURL: "https://juegos-de-mesa-9d7ef-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "juegos-de-mesa-9d7ef",
      storageBucket: "juegos-de-mesa-9d7ef.appspot.com",
      messagingSenderId: "289986562577",
      appId: "1:289986562577:web:02878f48c9154cebf8b0"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app); // Inicializa Firestore

    // Función para agregar un jugador a Firestore
    async function addPlayer() {
      const nombre = document.getElementById('nombre').value;
      const dia = document.getElementById('dia').value;
      const hora = document.getElementById('hora').value;
      
      if (nombre === '' || dia === '' || hora === '') {
        alert('Por favor, completa todos los campos.');
        return;
      }
      
      try {
        await addDoc(collection(db, "players"), { nombre, dia, hora });
        alert('Jugador registrado exitosamente!');
        getPlayers(); // Actualizar la lista de jugadores después de agregar
      } catch (error) {
        console.error('Error al registrar jugador:', error);
      }
    }

    // Función para obtener todos los jugadores de Firestore
    async function getPlayers() {
      const listaJugadores = document.getElementById('lista-jugadores');
      listaJugadores.innerHTML = ''; // Limpiar la lista antes de agregar los jugadores
      
      try {
        const querySnapshot = await getDocs(collection(db, "players"));
        querySnapshot.forEach((doc) => {
          const jugador = doc.data();
          const li = document.createElement('li');
          li.textContent = `${jugador.nombre} - ${jugador.dia} - ${jugador.hora}`;
          li.setAttribute('data-id', doc.id);
          li.innerHTML += ` <button onclick="deletePlayer('${doc.id}')">Eliminar</button> 
                            <button onclick="editPlayer('${doc.id}')">Editar</button>`;
          listaJugadores.appendChild(li);
        });
      } catch (error) {
        console.error('Error al obtener jugadores:', error);
      }
    }

    // Función para eliminar un jugador
    async function deletePlayer(id) {
      try {
        await deleteDoc(doc(db, "players", id));
        alert('Jugador eliminado correctamente!');
        getPlayers(); // Actualizar la lista de jugadores después de eliminar
      } catch (error) {
        console.error('Error al eliminar jugador:', error);
      }
    }

    // Función para editar un jugador
    function editPlayer(id) {
      const nombre = prompt('Nuevo nombre:');
      const dia = prompt('Nuevo día (YYYY-MM-DD):');
      const hora = prompt('Nueva hora (HH:MM):');
      
      if (nombre && dia && hora) {
        updatePlayer(id, { nombre, dia, hora });
      }
    }

    // Función para actualizar un jugador en Firestore
    async function updatePlayer(id, newData) {
      try {
        const playerRef = doc(db, "players", id);
        await updateDoc(playerRef, newData);
        alert('Jugador actualizado correctamente!');
        getPlayers(); // Actualizar la lista de jugadores después de actualizar
      } catch (error) {
        console.error('Error al actualizar jugador:', error);
      }
    }

    // Función para manejar cambios en las fechas
    function updateDates() {
      console.log('Función updateDates llamada');
      // Aquí puedes añadir lógica para manejar cambios en las fechas
    }

    // Llamar a getPlayers al cargar la página para mostrar los jugadores existentes
    getPlayers();
  </script>
</body>
</html>
